var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function i(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function c(t){t.parentNode.removeChild(t)}function l(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function f(){return u(" ")}function d(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function p(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function m(t,e){t.value=null==e?"":e}let h;function v(t){h=t}function b(){if(!h)throw new Error("Function called outside component initialization");return h}const x=[],$=[],I=[],_=[],y=Promise.resolve();let S=!1;function A(t){I.push(t)}let C=!1;const E=new Set;function w(){if(!C){C=!0;do{for(let t=0;t<x.length;t+=1){const e=x[t];v(e),N(e.$$)}for(v(null),x.length=0;$.length;)$.pop()();for(let t=0;t<I.length;t+=1){const e=I[t];E.has(e)||(E.add(e),e())}I.length=0}while(x.length);for(;_.length;)_.pop()();S=!1,C=!1,E.clear()}}function N(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(A)}}const k=new Set;function D(t,e){-1===t.$$.dirty[0]&&(x.push(t),S||(S=!0,y.then(w)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function M(o,s,a,l,u,f,d=[-1]){const g=h;v(o);const p=o.$$={fragment:null,ctx:null,props:f,update:t,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(g?g.$$.context:s.context||[]),callbacks:n(),dirty:d,skip_bound:!1};let m=!1;if(p.ctx=a?a(o,s.props||{},((t,e,...n)=>{const r=n.length?n[0]:e;return p.ctx&&u(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),m&&D(o,t)),e})):[],p.update(),m=!0,r(p.before_update),p.fragment=!!l&&l(p.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);p.fragment&&p.fragment.l(t),t.forEach(c)}else p.fragment&&p.fragment.c();s.intro&&((b=o.$$.fragment)&&b.i&&(k.delete(b),b.i(x))),function(t,n,o,s){const{fragment:a,on_mount:c,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,o),s||A((()=>{const n=c.map(e).filter(i);l?l.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(A)}(o,s.target,s.anchor,s.customElement),w()}var b,x;v(g)}var O=function(t,e){return e.length>1?e.indexOf(t.slice(-1))>-1:t.slice(-1)===e},T=function(t,e){return t.slice(t.length-e.length)===e};var z,L=(function(t,e){var n,r=["al","adj","assn","Ave","BSc","MSc","Cell","Ch","Co","cc","Corp","Dem","Dept","ed","eg","Eq","Eqs","est","est","etc","Ex","ext","Fig","fig","Figs","figs","i.e","ie","Inc","inc","Jan","Feb","Mar","Apr","Jun","Jul","Aug","Sep","Sept","Oct","Nov","Dec","jr","mi","Miss","Mrs","Mr","Ms","Mol","mt","mts","no","Nos","PhD","MD","BA","MA","MM","pl","pop","pp","Prof","Dr","pt","Ref","Refs","Rep","repr","rev","Sec","Secs","Sgt","Col","Gen","Rep","Sen","Gov","Lt","Maj","Capt","St","Sr","sr","Jr","jr","Rev","Sun","Mon","Tu","Tue","Tues","Wed","Th","Thu","Thur","Thurs","Fri","Sat","trans","Univ","Viz","Vol","vs","v"];e.setAbbreviations=function(t){n=t||r};var i=e.isCapitalized=function(t){return/^[A-Z][a-z].*/.test(t)||o(t)};e.isSentenceStarter=function(t){return i(t)||/``|"|'/.test(t.substring(0,2))},e.isCommonAbbreviation=function(t){var e=t.replace(/[-'`~!@#$%^&*()_|+=?;:'",.<>\{\}\[\]\\\/]/gi,"");return~n.indexOf(e)},e.isTimeAbbreviation=function(t,e){return("a.m."===t||"p.m."===t)&&"day"===e.replace(/\W+/g,"").slice(-3).toLowerCase()},e.isDottedAbbreviation=function(t){var e=t.replace(/[\(\)\[\]\{\}]/g,"").match(/(.\.)*/);return e&&e[0].length>0},e.isCustomAbbreviation=function(t){return t.length<=3||i(t)},e.isNameAbbreviation=function(t,e){return e.length>0&&(!!(t<5&&e[0].length<6&&i(e[0]))||e.filter((function(t){return/[A-Z]/.test(t.charAt(0))})).length>=3)};var o=e.isNumber=function(t,e){return e&&(t=t.slice(e-1,e+2)),!isNaN(t)};e.isPhoneNr=function(t){return t.match(/^(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$/)},e.isURL=function(t){return t.match(/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/)},e.isConcatenated=function(t){var e=0;return!(!((e=t.indexOf("."))>-1||(e=t.indexOf("!"))>-1||(e=t.indexOf("?"))>-1)||!t.charAt(e+1).match(/[a-zA-Z].*/))&&[t.slice(0,e),t.slice(e+1)]},e.isBoundaryChar=function(t){return"."===t||"!"===t||"?"===t}}(z={exports:{}},z.exports),z.exports),R=" @~@ ",j=R.trim(),F=new RegExp("\\S",""),Z=new RegExp("\\n+|[-#=_+*]{4,}","g"),J=new RegExp("\\S+|\\n","g"),B=function(t,e){if(!t||"string"!=typeof t||!t.length)return[];if(!F.test(t))return[];var n,r,i={newline_boundaries:!1,html_boundaries:!1,html_boundaries_tags:["p","div","ul","ol"],sanitize:!1,allowed_tags:!1,preserve_whitespace:!1,abbreviations:null};if("boolean"==typeof e)i.newline_boundaries=!0;else for(var o in e)i[o]=e[o];if(L.setAbbreviations(i.abbreviations),i.newline_boundaries&&(t=t.replace(Z,R)),i.html_boundaries){var s="(<br\\s*\\/?>|<\\/("+i.html_boundaries_tags.join("|")+")>)",a=new RegExp(s,"g");t=t.replace(a,"$1 @~@ ")}(i.sanitize||i.allowed_tags)&&(i.allowed_tags||(i.allowed_tags=[""]),t=function(t,e){if(("string"==typeof t||t instanceof String)&&"undefined"!=typeof document){var n=document.createElement("DIV");n.innerHTML=t,t=(n.textContent||"").trim()}else"object"==typeof t&&t.textContent&&(t=(t.textContent||"").trim());return t}(t));var c=0,l=0,u=[],f=[],d=[];if(!(n=i.preserve_whitespace?(r=t.split(/(<br\s*\/?>|\S+|\n+)/)).filter((function(t,e){return e%2})):t.trim().match(J))||!n.length)return[];for(var g=0,p=n.length;g<p;g++)if(c++,d.push(n[g]),~n[g].indexOf(",")&&(c=0),L.isBoundaryChar(n[g])||O(n[g],"?!")||n[g]===j)(i.newline_boundaries||i.html_boundaries)&&n[g]===j&&d.pop(),f.push(d),c=0,d=[];else if((O(n[g],'"')||O(n[g],"”"))&&(n[g]=n[g].slice(0,-1)),O(n[g],".")){if(g+1<p){if(2===n[g].length&&isNaN(n[g].charAt(0)))continue;if(L.isCommonAbbreviation(n[g]))continue;if(L.isSentenceStarter(n[g+1])){if(L.isTimeAbbreviation(n[g],n[g+1]))continue;if(L.isNameAbbreviation(c,n.slice(g,6)))continue;if(L.isNumber(n[g+1])&&L.isCustomAbbreviation(n[g]))continue}else{if(T(n[g],".."))continue;if(L.isDottedAbbreviation(n[g]))continue;if(L.isNameAbbreviation(c,n.slice(g,5)))continue}}f.push(d),d=[],c=0}else{if((l=n[g].indexOf("."))>-1){if(L.isNumber(n[g],l))continue;if(L.isDottedAbbreviation(n[g]))continue;if(L.isURL(n[g])||L.isPhoneNr(n[g]))continue}(u=L.isConcatenated(n[g]))&&(d.pop(),d.push(u[0]),f.push(d),c=0,(d=[]).push(u[1]))}return d.length&&f.push(d),(f=f.filter((function(t){return t.length>0}))).slice(1).reduce((function(t,e){var n=t[t.length-1];return 1===n.length&&/^.{1,2}[.]$/.test(n[0])&&!/[.]/.test(e[0])?(t.pop(),t.push(n.concat(e)),t):(t.push(e),t)}),[f[0]]).map((function(t,e){if(i.preserve_whitespace&&!i.newline_boundaries&&!i.html_boundaries){var n=2*t.length;return 0===e&&(n+=1),r.splice(0,n).join("")}return t.join(" ")}))};function P(t,e,n){const r=t.slice();return r[20]=e[n].source,r[21]=e[n].target,r[22]=e[n].id,r[23]=e[n].status,r[24]=e,r[25]=n,r}function q(t){let e,n,i,o,p,m,h,v,b,x,$,I,_,y,S,A,C,E,w,N,k,D,M,O,T,z,L,R,j,F,Z,J=H/1e3+"",B=t[0],q=[];for(let e=0;e<B.length;e+=1)q[e]=V(P(t,B,e));return{c(){e=l("div"),n=l("button"),n.textContent="立即保存",i=f(),o=l("label"),p=l("input"),m=u("\n        自动保存（每"),h=u(J),v=u("秒保存一次）"),b=f(),x=l("label"),x.innerHTML='<input type="checkbox" name="translator" disabled=""/>\n        启用翻译服务',$=f(),I=l("a"),I.textContent="如何配置翻译服务（开发中）",_=f(),y=l("button"),y.textContent="导出到剪贴板",S=f(),A=l("a"),A.textContent="帮助",C=f(),E=l("button"),E.textContent="清空所有内容",w=f(),N=l("div"),k=l("div"),D=l("div"),M=f(),O=l("div"),T=f(),z=l("div");for(let t=0;t<q.length;t+=1)q[t].c();L=f(),R=l("div"),j=l("textarea"),g(p,"type","checkbox"),g(p,"name","autosave"),g(o,"for","autosave"),g(o,"class","svelte-1crgrsf"),g(x,"for","translator"),g(x,"class","svelte-1crgrsf"),g(I,"disabled",""),g(I,"href","https://github.com/ddrpa/otlite"),g(I,"target","_blank"),g(A,"href","https://github.com/ddrpa/otlite"),g(A,"target","_blank"),g(e,"class","tools svelte-1crgrsf"),g(D,"class","resize-bar svelte-1crgrsf"),g(O,"class","resize-line svelte-1crgrsf"),g(z,"class","pane-left-actual svelte-1crgrsf"),g(k,"class","pane-left svelte-1crgrsf"),j.disabled=!0,g(j,"class","preview-textarea svelte-1crgrsf"),j.value=t[2],g(R,"class","pane-right svelte-1crgrsf"),g(N,"class","pane-container svelte-1crgrsf")},m(r,c){a(r,e,c),s(e,n),s(e,i),s(e,o),s(o,p),s(o,m),s(o,h),s(o,v),s(e,b),s(e,x),s(e,$),s(e,I),s(e,_),s(e,y),s(e,S),s(e,A),s(e,C),s(e,E),a(r,w,c),a(r,N,c),s(N,k),s(k,D),s(k,M),s(k,O),s(k,T),s(k,z);for(let t=0;t<q.length;t+=1)q[t].m(z,null);s(N,L),s(N,R),s(R,j),F||(Z=[d(n,"click",t[7]),d(p,"change",t[6]),d(y,"click",t[8]),d(E,"click",t[9])],F=!0)},p(t,e){if(25&e){let n;for(B=t[0],n=0;n<B.length;n+=1){const r=P(t,B,n);q[n]?q[n].p(r,e):(q[n]=V(r),q[n].c(),q[n].m(z,null))}for(;n<q.length;n+=1)q[n].d(1);q.length=B.length}4&e&&(j.value=t[2])},d(t){t&&c(e),t&&c(w),t&&c(N),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(q,t),F=!1,r(Z)}}}function U(t){let e,n,i,o,s,u,p;return{c(){e=l("button"),e.textContent="confirm",n=f(),i=l("a"),i.textContent="帮助",o=f(),s=l("textarea"),g(i,"href","https://github.com/ddrpa/otlite"),g(i,"target","_blank"),g(s,"class","source-textarea svelte-1crgrsf"),g(s,"placeholder","在此处粘贴要翻译的文本")},m(r,c){a(r,e,c),a(r,n,c),a(r,i,c),a(r,o,c),a(r,s,c),m(s,t[1]),u||(p=[d(e,"click",t[5]),d(s,"input",t[10])],u=!0)},p(t,e){2&e&&m(s,t[1])},d(t){t&&c(e),t&&c(n),t&&c(i),t&&c(o),t&&c(s),u=!1,r(p)}}}function V(t){let e,n,i,o,h,v,b,x,$,I,_,y,S,A=t[20]+"",C=`<#Segment${t[22]}>`;function E(){t[11].call(x,t[24],t[25])}function w(){return t[12](t[23],t[24],t[25])}function N(){return t[13](t[21],t[20],t[24],t[25],t[23])}return{c(){e=l("p"),n=u(A),i=f(),o=l("span"),h=u(C),b=f(),x=l("textarea"),I=f(),_=l("button"),_.textContent="revert\n            ",g(o,"class",v="segment-tag\n\t\t\t\t "+(t[3].INITIALIZED===t[23]?"initialized":"")+"\n\t\t\t\t "+(t[3].MODIFIED===t[23]?"modified":"")+" svelte-1crgrsf"),g(x,"data-segment-id",$=t[22]),g(x,"class","line-editor svelte-1crgrsf")},m(r,c){a(r,e,c),s(e,n),s(e,i),s(e,o),s(o,h),a(r,b,c),a(r,x,c),m(x,t[21]),a(r,I,c),a(r,_,c),y||(S=[d(x,"input",E),d(x,"keyup",t[4]),d(x,"blur",w),d(_,"click",N)],y=!0)},p(e,r){t=e,1&r&&A!==(A=t[20]+"")&&p(n,A),1&r&&C!==(C=`<#Segment${t[22]}>`)&&p(h,C),1&r&&v!==(v="segment-tag\n\t\t\t\t "+(t[3].INITIALIZED===t[23]?"initialized":"")+"\n\t\t\t\t "+(t[3].MODIFIED===t[23]?"modified":"")+" svelte-1crgrsf")&&g(o,"class",v),1&r&&$!==($=t[22])&&g(x,"data-segment-id",$),1&r&&m(x,t[21])},d(t){t&&c(e),t&&c(b),t&&c(x),t&&c(I),t&&c(_),y=!1,r(S)}}}function G(e){let n;function r(t,e){return t[0].length<1?U:q}let i=r(e),o=i(e);return{c(){n=l("main"),o.c()},m(t,e){a(t,n,e),o.m(n,null)},p(t,[e]){i===(i=r(t))&&o?o.p(t,e):(o.d(1),o=i(t),o&&(o.c(),o.m(n,null)))},i:t,o:t,d(t){t&&c(n),o.d()}}}const H=8e3,W=/^[\r\n\t\s]*/g,K=/[\r\n\t\s]*$/g;function Q(t,e){localStorage.setItem("segments",JSON.stringify(t)),localStorage.setItem("version",e)}function X(t){const e=document.querySelector(`.line-editor[data-segment-id="${t}"]`);null!==e&&(e.focus(),e.setSelectionRange(0,-1))}function Y(t,e,n){let r;const i={INITIALIZED:0,MODIFIED:2};let o,s="",a=[];function c(){let t=parseInt(localStorage.getItem("version"));if(isNaN(t)&&(t=1),!(t>1)){if(1===t){let t=[];try{t=JSON.parse(localStorage.getItem("segments"))??[]}catch(t){}return n(0,a=t),void Q(t,1)}return l.get(t)(),localStorage.setItem("version",t+1),c()}for(alert("存档版本高于当前软件版本");;);}!function(t){b().$$.on_mount.push(t)}((async()=>{c(),o=setInterval((()=>Q(a,1)),H)})),function(t){b().$$.on_destroy.push(t)}((async()=>{void 0!==o&&clearInterval(o)}));const l=new Map([[1,()=>{let t=JSON.parse(localStorage.getItem("segments"));localStorage.setItem("segments",JSON.stringify(t))}]]);function u(t){return t<a.length?t+1:t}return t.$$.update=()=>{1&t.$$.dirty&&n(2,r=a.reduce(((t,e)=>t+e.prefix+e.target.trim()+e.suffix),""))},[a,s,r,i,function(t){if(t.ctrlKey){const e=parseInt(t.target.dataset.segmentId);"Enter"===t.key||"p"===t.key?X(function(t){return t>1?t-1:t}(e)):"n"===t.key?X(u(e)):"u"===t.key?X(function(t){return a.filter((t=>t.status!==i.MODIFIED)).map((t=>t.id)).find((e=>e>t))??t}(e)):"r"===t.key&&n(0,a=a.map((t=>t.id===e?{...t,target:t.source}:t)))}else if("Enter"===t.key){X(u(parseInt(t.target.dataset.segmentId)))}return!1},function(){n(0,a=B(s,{}).map((t=>{const e=t.match(W)[0]??"",n=t.match(K)[0]??"";if((t=t.trim()).lastIndexOf("\n")>-1){let r=t.split("\n").map((t=>t.trim())).filter((t=>t.length>0)).map((t=>({prefix:"",suffix:"\n",source:t})));return r[0].prefix=e,r[r.length-1].suffix=n,r}return[{prefix:e,suffix:n,source:t}]})).flat().map(((t,e)=>({...t,target:t.source,id:e+1,status:i.INITIALIZED})))),Q(a,1)},function(t){t.target.value?(void 0===o&&(o=setInterval((()=>Q(a,1)),H)),Q(a,1)):void 0!==o&&clearInterval(o)},function(){Q(a,1)},function(){navigator.clipboard.writeText(r).then((()=>{console.log("copied"),console.log(r)})).catch(console.error)},function(){n(0,a=[]),localStorage.removeItem("segments"),localStorage.removeItem("version")},function(){s=this.value,n(1,s)},function(t,e){t[e].target=this.value,n(0,a)},(t,e,r)=>n(0,e[r].status=i.MODIFIED,a),(t,e,r,o,s)=>{n(0,r[o].target=e,a),n(0,r[o].status=i.INITIALIZED,a)}]}return new class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),M(this,t,Y,G,o,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
